<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
      .control-panel {
        margin: 20px;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 8px;
        font-family: Arial, sans-serif;
      }
      
      .slider-group, .control-group {
        margin: 10px 0;
      }
      
      .slider-label {
        display: inline-block;
        width: 120px;
      }
      
      .blue-label { color: #0066cc; }
      .red-label { color: #cc0000; }
      .green-label { color: #00cc00; }
      
      button {
        margin: 5px;
        padding: 8px 15px;
        cursor: pointer;
      }
      
      select {
        padding: 5px;
        margin-left: 10px;
      }
      
      #controls {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }
      
      #canvas-container {
        position: relative;
        margin: 20px 0;
        border: 2px solid #ddd;
        height: 400px;
      }
      
      .canvas-controls {
        position: absolute;
        z-index: 1;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        width: 200px;
      }
      
      .blue-controls {
        top: 10px;
        right: 10px;
      }
      
      .red-controls {
        bottom: 10px;
        right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="control-panel">
      <div id="canvas-container">
        <!-- Μπλε Ελέγχοι -->
        <div class="canvas-controls blue-controls">
          <div class="slider-group">
            <span class="slider-label blue-label">Ύψος</span>
            <div id="amplitude-slider-blue"></div>
            <span id="amplitude-value-blue">20</span>
          </div>
          <div class="slider-group">
            <span class="slider-label blue-label">Συχνότητα</span>
            <div id="frequency-slider-blue"></div>
            <span id="frequency-value-blue">1</span>
          </div>
          <div class="slider-group">
            <span class="slider-label blue-label">Φάση</span>
            <select class="phase-select" data-wave="blue">
              <option value="0">0°</option>
              <option value="180">180°</option>
            </select>
          </div>
          <div class="slider-group">
            <span class="slider-label blue-label">Κατεύθυνση</span>
            <select class="direction-select" data-wave="blue">
              <option value="left">Αριστερά</option>
              <option value="right">Δεξιά</option>
            </select>
          </div>
        </div>

        <!-- Κόκκινοι Ελέγχοι -->
        <div class="canvas-controls red-controls">
          <div class="slider-group">
            <span class="slider-label red-label">Ύψος</span>
            <div id="amplitude-slider-red"></div>
            <span id="amplitude-value-red">20</span>
          </div>
          <div class="slider-group">
            <span class="slider-label red-label">Συχνότητα</span>
            <div id="frequency-slider-red"></div>
            <span id="frequency-value-red">1</span>
          </div>
          <div class="slider-group">
            <span class="slider-label red-label">Φάση</span>
            <select class="phase-select" data-wave="red">
              <option value="0">0°</option>
              <option value="180">180°</option>
            </select>
          </div>
          <div class="slider-group">
            <span class="slider-label red-label">Κατεύθυνση</span>
            <select class="direction-select" data-wave="red">
              <option value="left">Αριστερά</option>
              <option value="right">Δεξιά</option>
            </select>
          </div>
        </div>
      </div>

      <div id="controls">
        <div>
          <button id="playBtn">▶ Start</button>
          <button id="resetBtn">↻ Reset</button>
        </div>
        <div>
          <span class="slider-label">Ταχύτητα Κύματος</span>
          <div id="speed-slider" style="display: inline-block; width: 150px;"></div>
          <span id="speed-value">100</span>
        </div>
        <div>
          <select id="green-visibility">
            <option value="visible">Πράσινο Ορατό</option>
            <option value="hidden">Πράσινο Αόρατο</option>
          </select>
        </div>
      </div>
    </div>

    <script>
      let handLeft, handRight;

      function preload() {
        handLeft = loadImage('handleft.png');
        handRight = loadImage('handright.png');
      }

      class WaveSystem {
        constructor(color, yPosition, waveKey) {
          this.waveKey = waveKey;
          this.balls = [];
          this.color = color;
          this.yPosition = yPosition;
          this.amplitude = 20;
          this.frequency = 1;
          this.phase = 0;
          this.direction = 'left';
          this.ballSize = 2;
          this.gap = 1;
          
          this.selectDirection = select(`[data-wave="${this.waveKey}"].direction-select`);
          this.selectPhase = select(`[data-wave="${this.waveKey}"].phase-select`);
          
          this.hand = {
            img: handLeft,
            x: 50,
            y: yPosition,
            firstBall: null
          };

          this.selectDirection.changed(() => this.updateDirection());
          this.selectPhase.changed(() => this.phase = parseInt(this.selectPhase.value()));
        }

        updateHandPosition() {
          this.hand.img = this.direction === 'left' ? handLeft : handRight;
          this.hand.x = this.direction === 'left' ? 50 : width - 50;
          this.updateFirstBall();
        }

        updateFirstBall() {
          const startPosition = this.direction === 'left' ? 50 : width - 50;
          this.hand.firstBall = this.balls.reduce((closest, ball) => {
            const distance = Math.abs(ball.x - startPosition);
            return distance < closest.distance ? {ball, distance} : closest;
          }, {ball: null, distance: Infinity}).ball;
        }

        initBalls() {
          const totalSpace = this.ballSize + this.gap;
          for (let x = 50; x < width - 50; x += totalSpace) {
            this.balls.push({ 
              x: x,
              baseY: this.yPosition,
              startTime: Infinity,
              currentY: this.yPosition 
            });
          }
          this.updateFirstBall();
        }

        updateDirection() {
          this.direction = this.selectDirection.value();
          this.updateStartTimes(speed);
          this.updateHandPosition();
        }

        updateStartTimes(speed) {
          const startPosition = this.direction === 'left' ? 50 : width - 50;
          this.balls.forEach(ball => {
            const distance = Math.abs(ball.x - startPosition);
            ball.startTime = speed > 0 ? distance / speed : Infinity;
          });
        }

        draw(simTime, speed) {
          fill(this.color);
          if(this.hand.firstBall) this.hand.y = this.hand.firstBall.currentY;

          this.balls.forEach(ball => {
            if(simTime >= ball.startTime) {
              const t = simTime - ball.startTime;
              const phase = radians(this.phase) + TWO_PI * this.frequency * t;
              ball.currentY = ball.baseY + this.amplitude * sin(phase);
            } else {
              ball.currentY = ball.baseY;
            }
            ellipse(ball.x, ball.currentY, this.ballSize, this.ballSize);
          });
        }
      }

      let blueWave, redWave;
      let isPlaying = false;
      let simTime = 0;
      let lastUpdate = 0;
      let speed = 100;
      let greenVisible = true;
      const greenBaseY = 200;

      function setup() {
        const canvas = createCanvas(800, 400);
        canvas.parent('canvas-container');
        noStroke();
        imageMode(CENTER);

        blueWave = new WaveSystem(color(0, 100, 200), 100, 'blue');
        redWave = new WaveSystem(color(200, 0, 0), 300, 'red');
        blueWave.initBalls();
        redWave.initBalls();
        blueWave.updateHandPosition();
        redWave.updateHandPosition();

        // Speed Slider
        const speedSlider = createSlider(0, 500, 100);
        speedSlider.parent('speed-slider');
        speedSlider.input(() => {
          speed = speedSlider.value();
          select('#speed-value').html(speed);
          blueWave.updateStartTimes(speed);
          redWave.updateStartTimes(speed);
        });

        // Blue Sliders
        createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-blue', 'amplitude-value-blue', v => blueWave.amplitude = v);
        createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-blue', 'frequency-value-blue', v => blueWave.frequency = v);

        // Red Sliders
        createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-red', 'amplitude-value-red', v => redWave.amplitude = v);
        createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-red', 'frequency-value-red', v => redWave.frequency = v);

        // Controls
        select('#playBtn').mousePressed(() => {
          isPlaying = !isPlaying;
          select('#playBtn').html(isPlaying ? '⏸ Pause' : '▶ Start');
          lastUpdate = millis();
        });
        
        select('#resetBtn').mousePressed(() => {
          simTime = 0;
          isPlaying = false;
          blueWave.initBalls();
          redWave.initBalls();
          redraw();
        });

        select('#green-visibility').changed(() => {
          greenVisible = select('#green-visibility').value() === 'visible';
        });
      }

      function createSliderWithUpdates(min, max, value, step, parentId, valueId, updateCallback) {
        const parent = document.getElementById(parentId);
        if(parent) {
          const slider = createSlider(min, max, value, step);
          slider.parent(parent);
          slider.input(() => {
            const val = step >= 1 ? slider.value() : slider.value().toFixed(1);
            select('#'+valueId).html(val);
            updateCallback(parseFloat(val));
          });
        }
      }

      function draw() {
        background(220);
        
        // Γραμμές ηρεμίας
        stroke(200);
        drawingContext.setLineDash([5, 5]);
        line(50, blueWave.yPosition, width-50, blueWave.yPosition);
        line(50, redWave.yPosition, width-50, redWave.yPosition);
        line(50, greenBaseY, width-50, greenBaseY);
        drawingContext.setLineDash([]);

        if(isPlaying) {
          const now = millis();
          simTime += (now - lastUpdate)/1000;
          lastUpdate = now;
        }

        blueWave.draw(simTime, speed);
        redWave.draw(simTime, speed);

        // Πράσινο κύμα
        if(greenVisible) {
          fill(0, 200, 0);
          for(let i=0; i<blueWave.balls.length; i++) {
            const y = greenBaseY + 
                     (blueWave.balls[i].currentY - blueWave.yPosition) + 
                     (redWave.balls[i].currentY - redWave.yPosition);
            ellipse(blueWave.balls[i].x, y, 2, 2);
          }
        }

        // Χέρια
        if(isPlaying) {
          image(blueWave.hand.img, blueWave.hand.x, blueWave.hand.y, 32, 32);
          image(redWave.hand.img, redWave.hand.x, redWave.hand.y, 32, 32);
        }
      }
    </script>
  </body>
</html>
