<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wave Simulator Final</title>
  <!-- Φόρτωση p5.js και p5.dom -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.dom.min.js"></script>
  <style>
    /* Βασικό styling για τη διάταξη */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    #top-container {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    #simulation-container {
      width: 800px;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #options-container {
      width: 320px;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px;
      overflow-y: auto;
    }
    #controls-container {
      width: 800px;
      height: 120px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      margin-bottom: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div id="top-container">
    <div id="simulation-container"></div>
    <div id="options-container"></div>
  </div>
  <div id="controls-container"></div>

  <script>
    /* --- Global Ρυθμίσεις --- */
    // Παράμετροι για τα κύματα
    window.blueParams = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    window.redParams  = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    // Ορατότητα για κάθε κύμα (μέσω επιλογών)
    window.blueVisible = true;
    window.redVisible = true;
    // Έλεγχος προσομοίωσης
    window.isPlaying = false;
    window.simTime = 0;
    window.lastUpdate = 0;
    window.simSpeed = 1;
    // Ορατότητα του πράσινου κυμάτος (υπέρθεση)
    window.greenVisible = true;
    // Λειτουργία μέσου: false = Εγκάρσιο (transverse), true = Διάμηκες (longitudinal)
    window.isLongitudinal = false;
    // Ο baseline του πράσινου (σταθερό σημείο για την υπέρθεση)
    if(!window.isLongitudinal){
      window.greenBase = { y: 200 };
    } else {
      window.greenBase = { x: 200 };
    }

    /* ------------------------------ */
    /* p5 Sketch: Simulation Canvas   */
    /* ------------------------------ */
    let simulationSketch = function(p) {
      let blueWave, redWave;
      let handLeft, handRight;
      
      p.preload = function() {
        // Φόρτωση εικόνων για τα "χέρια" – fallback αν δεν υπάρχουν
        handLeft = p.loadImage('handleft.png', undefined, function() {
          let g = p.createGraphics(32, 32);
          g.fill(0, 100, 200);
          g.ellipse(16, 16, 32, 32);
          handLeft = g;
        });
        handRight = p.loadImage('handright.png', undefined, function() {
          let g = p.createGraphics(32, 32);
          g.fill(200, 0, 0);
          g.ellipse(16, 16, 32, 32);
          handRight = g;
        });
      };
      
      p.setup = function() {
        let canvas = p.createCanvas(800, 400);
        canvas.parent('simulation-container');
        p.noStroke();
        p.imageMode(p.CENTER);
        // Δημιουργία κυμάτων σύμφωνα με την αρχική λογική.
        // Για κάθε κύμα, τα voids (ή οι μπάρες) θα τοποθετηθούν κατά μήκος του x.
        // Οι τιμές base που δίνονται (100 για μπλε, 300 για κόκκινο) είναι το centerY στα transverse mode.
        // Στο longitudinal mode, αυτά θα χρησιμοποιηθούν ως baseline για το x.
        blueWave = new WaveSystem(p, p.color(0, 100, 200), 100, 'blue');
        redWave  = new WaveSystem(p, p.color(200, 0, 0), 300, 'red');
        blueWave.initVoids();
        redWave.initVoids();
        window.lastUpdate = p.millis();
      };
      
      p.draw = function() {
        p.background(245);
        // Σχεδίαση baseline του μέσου
        p.stroke(200);
        if(!window.isLongitudinal){
          p.line(50, 200, p.width - 50, 200);
        } else {
          p.line(200, 50, 200, p.height - 50);
        }
        p.noStroke();
        
        // Ενημέρωση χρόνου προσομοίωσης
        let now = p.millis();
        if(window.isPlaying){
          let dt = (now - window.lastUpdate) / 1000 * window.simSpeed;
          window.simTime += dt;
        }
        window.lastUpdate = now;
        
        // Ενημέρωση και σχεδίαση των κυμάτων (αν εμφανίζονται ξεχωριστά σύμφωνα με τα options)
        blueWave.update(window.simTime);
        redWave.update(window.simTime);
        if(window.blueVisible) { blueWave.draw(); }
        if(window.redVisible) { redWave.draw(); }
        
        // Σχεδίαση του πράσινου κυμάτος ως υπέρθεση
        p.fill(0, 200, 0, 100);
        if(!window.isLongitudinal) {
          // Transverse: οριζόντια μετατόπιση – άθροισμα των μετατοπίσεων και σχεδίαση κύκλων
          for(let i = 0; i < blueWave.voids.length; i++){
            let blueDisp = blueWave.voids[i].current - blueWave.voids[i].center;
            let redDisp = redWave.voids[i].current - redWave.voids[i].center;
            let finalY = window.greenBase.y + blueDisp + redDisp;
            p.ellipse(blueWave.voids[i].centerX, finalY, blueWave.voidDiameter);
          }
        } else {
          // Longitudinal: οριζόντια μετατόπιση – σχεδίαση κατακόρυφων μπαρών με κέντρο στο ίδιο void
          for(let i = 0; i < blueWave.voids.length; i++){
            let blueDisp = blueWave.voids[i].current - blueWave.voids[i].center;
            let redDisp = redWave.voids[i].current - redWave.voids[i].center;
            let finalX = window.greenBase.x + blueDisp + redDisp;
            p.rectMode(p.CENTER);
            p.rect(finalX, window.greenBase.y, blueWave.voidDiameter, 60);
          }
        }
      };
      
      // Κλάση WaveSystem: κάθε κύμα έχει "voids" που αντιστοιχούν στις θέσεις διάδοσης
      function WaveSystem(p, col, base, waveKey) {
        this.p = p;
        this.col = col;
        this.base = base; // Στο transverse mode, αυτό είναι το centerY, ενώ στο longitudinal mode, αυτός γίνεται ο baseline για x.
        this.waveKey = waveKey;
        this.voids = []; // Κάθε void έχει: centerX (σταθερό), center (η αρχική τιμή που θα ταλαντωθεί), current (μετατοπισμένη τιμή)
        this.voidDiameter = 4;
        this.gap = 2;
        // "Χέρι": η πηγή του κύματος
        this.hand = { img: null, pos: { x: 50, y: this.base } };
        
        // Τοποθέτηση του "χεριού" ανάλογα με την κατεύθυνση διάδοσης
        this.updateHand = function() {
          let params = (this.waveKey === 'blue') ? window.blueParams : window.redParams;
          if(!window.isLongitudinal){
            // Transverse: για direction 'left', το χέρι τοποθετείται στη δεξιά πλευρά
            if(params.direction === 'left'){
              this.hand.img = handRight;
              this.hand.pos.x = p.width - 50;
            } else {
              this.hand.img = handLeft;
              this.hand.pos.x = 50;
            }
          } else {
            // Longitudinal: ομοίως, αλλά το χέρι θα εμφανίζεται ως πηγή της οριζόντιας μετατόπισης
            if(params.direction === 'left'){
              this.hand.img = handRight;
              this.hand.pos.x = p.width - 50;
            } else {
              this.hand.img = handLeft;
              this.hand.pos.x = 50;
            }
          }
        };
        
        // initVoids: Δημιουργεί τα voids σε θέσεις κατά μήκος του x (σταθερά)
        this.initVoids = function() {
          this.voids = [];
          for(let x = 50; x < p.width - 50; x += (this.voidDiameter + this.gap)) {
            // Κάθε void αποθηκεύει το centerX (σταθερό) και center, το οποίο είναι το βασικό σημείο (base)
            this.voids.push({ centerX: x, center: this.base, current: this.base });
          }
          this.updateHand();
        };
        
        // update: Εφαρμόζει την κυματική εξίσωση
        this.update = function(t) {
          let params = (this.waveKey === 'blue') ? window.blueParams : window.redParams;
          let amplitude = params.amplitude;
          let frequency = params.frequency;
          let phase = p.radians(params.phase);
          // Σε transverse mode, ενημερώνουμε το current (y) για κάθε void
          // Σε longitudinal mode, ενημερώνουμε το current (x) για κάθε void
          for(let i = 0; i < this.voids.length; i++){
            let displacement = amplitude * p.sin(2 * p.PI * frequency * t + phase);
            if(!window.isLongitudinal){
              this.voids[i].current = this.voids[i].center + displacement;
            } else {
              this.voids[i].current = this.voids[i].center + displacement;
            }
          }
          // Ενημέρωση θέσης του "χεριού" βάσει του πρώτου void
          if(this.voids.length > 0) {
            if(!window.isLongitudinal){
              this.hand.pos.y = this.voids[0].current;
            } else {
              this.hand.pos.x = this.voids[0].current;
            }
          }
        };
        
        // draw: Σχεδιάζει τα voids και το χέρι
        this.draw = function() {
          let r = p.red(this.col), g = p.green(this.col), b = p.blue(this.col);
          p.fill(r, g, b, 100);
          if(!window.isLongitudinal){
            // Transverse: σχεδιάζουμε μικρές ελλείψεις ως κύκλους στα centerX, current (y)
            for(let i = 0; i < this.voids.length; i++){
              p.ellipse(this.voids[i].centerX, this.voids[i].current, this.voidDiameter);
            }
          } else {
            // Longitudinal: σχεδιάζουμε κατακόρυφες μπάρες (60px ύψους) με κέντρο στο (current, centerY)
            p.rectMode(p.CENTER);
            for(let i = 0; i < this.voids.length; i++){
              p.rect(this.voids[i].current, this.voids[i].center, this.voidDiameter, 60);
            }
          }
          if(this.hand.img) {
            p.image(this.hand.img, this.hand.pos.x, this.hand.pos.y, 32, 32);
          }
        };
      }
    };
    new p5(simulationSketch, 'simulation-container');

    /* ------------------------------ */
    /* p5 Sketch: Options Canvas        */
    /* ------------------------------ */
    let optionsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(320, 400);
        canvas.parent('options-container');
        p.textSize(16);
        p.noLoop();
        // Δημιουργούμε DOM στοιχεία για τους επιλογείς των κυμάτων
        // --- Μπλε Κύμα ---
        let blueTitle = p.createElement('h3', 'Μπλε Κύμα');
        blueTitle.parent('options-container');
        blueTitle.style('color', '#0066cc');
        // Checkbox για παρακολούθηση του Μπλε κύματος
        let blueChk = p.createCheckbox('Παρακολούθηση', window.blueVisible);
        blueChk.parent('options-container');
        blueChk.changed(function() { window.blueVisible = this.checked(); });
        p.createElement('label', 'Ύψος').parent('options-container');
        let blueAmp = p.createSlider(0, 100, window.blueParams.amplitude, 1);
        blueAmp.parent('options-container');
        blueAmp.changed(function() { window.blueParams.amplitude = parseInt(this.value()); });
        p.createElement('label', 'Συχνότητα').parent('options-container');
        let blueFreq = p.createSlider(0.1, 5, window.blueParams.frequency, 0.1);
        blueFreq.parent('options-container');
        blueFreq.changed(function() { window.blueParams.frequency = parseFloat(this.value()); });
        p.createElement('label', 'Φάση').parent('options-container');
        let bluePhase = p.createSelect();
        bluePhase.parent('options-container');
        bluePhase.option('0°', '0');
        bluePhase.option('180°', '180');
        bluePhase.changed(function() { window.blueParams.phase = parseInt(this.value()); });
        p.createElement('label', 'Κατεύθυνση').parent('options-container');
        let blueDir = p.createSelect();
        blueDir.parent('options-container');
        blueDir.option('Αριστερά', 'left');
        blueDir.option('Δεξιά', 'right');
        blueDir.changed(function() { window.blueParams.direction = this.value(); });
        
        // --- Κόκκινο Κύμα ---
        let redTitle = p.createElement('h3', 'Κόκκινο Κύμα');
        redTitle.parent('options-container');
        redTitle.style('color', '#cc0000');
        // Checkbox για παρακολούθηση του Κόκκινου κύματος
        let redChk = p.createCheckbox('Παρακολούθηση', window.redVisible);
        redChk.parent('options-container');
        redChk.changed(function() { window.redVisible = this.checked(); });
        p.createElement('label', 'Ύψος').parent('options-container');
        let redAmp = p.createSlider(0, 100, window.redParams.amplitude, 1);
        redAmp.parent('options-container');
        redAmp.changed(function() { window.redParams.amplitude = parseInt(this.value()); });
        p.createElement('label', 'Συχνότητα').parent('options-container');
        let redFreq = p.createSlider(0.1, 5, window.redParams.frequency, 0.1);
        redFreq.parent('options-container');
        redFreq.changed(function() { window.redParams.frequency = parseFloat(this.value()); });
        p.createElement('label', 'Φάση').parent('options-container');
        let redPhase = p.createSelect();
        redPhase.parent('options-container');
        redPhase.option('0°', '0');
        redPhase.option('180°', '180');
        redPhase.changed(function() { window.redParams.phase = parseInt(this.value()); });
        p.createElement('label', 'Κατεύθυνση').parent('options-container');
        let redDir = p.createSelect();
        redDir.parent('options-container');
        redDir.option('Αριστερά', 'left');
        redDir.option('Δεξιά', 'right');
        redDir.changed(function() { window.redParams.direction = this.value(); });
      };
    };
    new p5(optionsSketch, 'options-container');

    /* ------------------------------ */
    /* p5 Sketch: Controls Canvas       */
    /* ------------------------------ */
    let controlsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(800, 120);
        canvas.parent('controls-container');
        p.textSize(16);
        // Play/Pause κουμπί
        let playBtn = p.createButton('▶ Start');
        playBtn.parent('controls-container');
        playBtn.position(20, 20);
        playBtn.mousePressed(function() {
          window.isPlaying = !window.isPlaying;
          playBtn.html(window.isPlaying ? '⏸ Pause' : '▶ Start');
        });
        // Reset κουμπί
        let resetBtn = p.createButton('↻ Reset');
        resetBtn.parent('controls-container');
        resetBtn.position(120, 20);
        resetBtn.mousePressed(function() {
          window.simTime = 0;
        });
        // Checkbox για εμφάνιση/απόκρυψη του πράσινου κυμάτος
        let greenChk = p.createCheckbox('Εμφάνιση Πράσινου', window.greenVisible);
        greenChk.parent('controls-container');
        greenChk.position(220, 20);
        greenChk.changed(function() { window.greenVisible = this.checked(); });
        // Slider ταχύτητας προσομοίωσης
        p.createElement('label', 'Ταχύτητα').parent('controls-container').position(20, 60);
        let speedSlider = p.createSlider(0.1, 5, window.simSpeed, 0.1);
        speedSlider.parent('controls-container');
        speedSlider.position(100, 60);
        speedSlider.changed(function() { window.simSpeed = parseFloat(this.value()); });
        // Επιλογέας λειτουργίας μέσου: Transverse / Longitudinal
        let modeSelect = p.createSelect();
        modeSelect.parent('controls-container');
        modeSelect.position(300, 20);
        modeSelect.option('Εγκάρσιο', 'transverse');
        modeSelect.option('Διάμηκες', 'longitudinal');
        modeSelect.changed(function() {
          window.isLongitudinal = (this.value() === 'longitudinal');
          window.simTime = 0;
          // Επανεκκίνηση προσομοίωσης για ενημέρωση απεικόνισης
          location.reload();
        });
      };
      p.draw = function() {
        p.background(220,220,220,50);
      };
    };
    new p5(controlsSketch, 'controls-container');
  </script>
</body>
</html>
