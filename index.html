<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wave Simulator Final</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    /* Στυλ για τους καμβάδες και το layout */
    body {
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #top-container {
      display: flex;
      width: 1100px;
      margin-top: 10px;
    }
    #simulation-container,
    #options-container {
      border: 1px solid #ccc;
      position: relative;
    }
    #simulation-container {
      width: 800px;
      height: 400px;
    }
    #options-container {
      width: 320px;
      height: 400px;
      margin-left: 10px;
    }
    #controls-container {
      width: 800px;
      height: 120px;
      border: 1px solid #ccc;
      margin-top: 10px;
      position: relative;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="top-container">
      <!-- Καμβάς προσομοίωσης -->
      <div id="simulation-container"></div>
      <!-- Καμβάς επιλογών για τις ρυθμίσεις των κυμάτων -->
      <div id="options-container"></div>
    </div>
    <!-- Καμβάς χειριστηρίων -->
    <div id="controls-container"></div>
  </div>

  <script>
    /* --- Global Ρυθμίσεις --- */
    window.simTime = 0;
    window.lastUpdate = 0;
    window.isPlaying = false;
    window.simSpeed = 1;
    // false: οριζόντιο (εγκάρσιο), true: κατακόρυφο (διάμηκο)
    window.isVertical = false; 
    // Ρυθμίσεις για το πράσινο κύμα (η "βάση" του πράσινου είναι 200 για οριζόντια ή 200 για κατακόρυφη)
    if(!window.isVertical){
      window.greenBase = { y: 200 };
    } else {
      window.greenBase = { x: 200 };
    }
    // Αρχικές παράμετροι για κάθε κύμα
    window.blueParams = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    window.redParams  = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };

    /* ------------------------------ */
    /* p5 Sketch: Προσομοίωση         */
    /* ------------------------------ */
    let simulationSketch = function(p) {
      let blueWave, redWave;
      let handLeft, handRight;

      p.preload = function() {
        // Προσπάθεια φόρτωσης εικόνων χειρών – fallback σε p5 graphics αν αποτύχει
        handLeft = p.loadImage('handleft.png', undefined, function() {
          let g = p.createGraphics(32,32);
          g.fill(0,100,200);
          g.ellipse(16,16,32,32);
          handLeft = g;
        });
        handRight = p.loadImage('handright.png', undefined, function() {
          let g = p.createGraphics(32,32);
          g.fill(200,0,0);
          g.ellipse(16,16,32,32);
          handRight = g;
        });
      };

      p.setup = function() {
        let canvas = p.createCanvas(800, 400);
        canvas.parent('simulation-container');
        p.noStroke();
        p.imageMode(p.CENTER);

        // Ανάλογα με τη λειτουργία, ορίζουμε τις βάσεις των κυμάτων:
        if(!window.isVertical){
          // Οριζόντια λειτουργία: τοποθετούμε το Μπλε κύμα στη γραμμή y=100 και το Κόκκινο στη y=300
          blueWave = new WaveSystem(p, p.color(0,100,200), 100, window.blueParams, 'blue');
          redWave  = new WaveSystem(p, p.color(200,0,0), 300, window.redParams, 'red');
        } else {
          // Κατακόρυφη λειτουργία: τα κυματα τοποθετούνται σε κάθετη γραμμή (x=100 και x=300)
          blueWave = new WaveSystem(p, p.color(0,100,200), 100, window.blueParams, 'blue');
          redWave  = new WaveSystem(p, p.color(200,0,0), 300, window.redParams, 'red');
        }
        blueWave.initBalls();
        redWave.initBalls();
        window.lastUpdate = p.millis();
      };

      p.draw = function() {
        p.background(245);
        p.stroke(200);
        // Σχεδίαση γραμμών αναφοράς
        if(!window.isVertical){
          p.line(50, 100, p.width-50, 100);
          p.line(50, 300, p.width-50, 300);
          p.line(50, window.greenBase.y, p.width-50, window.greenBase.y);
        } else {
          p.line(100, 50, 100, p.height-50);
          p.line(300, 50, 300, p.height-50);
          p.line(window.greenBase.x, 50, window.greenBase.x, p.height-50);
        }
        p.noStroke();

        // Ενημέρωση χρόνου προσομοίωσης
        let now = p.millis();
        if(window.isPlaying){
          let dt = (now - window.lastUpdate)/1000 * window.simSpeed;
          window.simTime += dt;
        }
        window.lastUpdate = now;

        // Ενημέρωση και σχεδίαση κυμάτων
        blueWave.update(window.simTime);
        redWave.update(window.simTime);
        blueWave.draw();
        redWave.draw();

        // Σχεδίαση πράσινου κυμάτος ως συνδυασμός μετατοπίσεων
        p.fill(0,200,0,100);
        if(!window.isVertical){
          for(let i = 0; i < blueWave.balls.length; i++){
            let blueDisp = blueWave.balls[i].current - blueWave.balls[i].base;
            let redDisp = redWave.balls[i].current - redWave.balls[i].base;
            let greenY = window.greenBase.y + blueDisp + redDisp;
            p.ellipse(blueWave.balls[i].x, greenY, 8);
          }
        } else {
          for(let i = 0; i < blueWave.balls.length; i++){
            let blueDisp = blueWave.balls[i].current - blueWave.balls[i].base;
            let redDisp = redWave.balls[i].current - redWave.balls[i].base;
            let greenX = window.greenBase.x + blueDisp + redDisp;
            p.ellipse(greenX, blueWave.balls[i].y, 8);
          }
        }
      };

      // Κλάση WaveSystem (διατηρείται η λογική του αρχικού κώδικα)
      function WaveSystem(p, col, basePos, params, waveKey) {
        this.p = p;
        this.col = col;
        this.params = params;
        this.waveKey = waveKey;
        this.balls = [];
        this.ballSize = 4;  // όπως στο αρχικό
        this.gap = 2;
        this.basePos = basePos; // για οριζόντια: y, για κατακόρυφη: x

        // Ορισμός χειρός (χρήση εικόνων που φορτώθηκαν)
        this.hand = {
          img: (this.params.direction === 'left') ? handLeft : handRight,
          pos: { x: 0, y: 0 }
        };

        this.initBalls = function() {
          this.balls = [];
          if(!window.isVertical){
            // Οριζόντια: τοποθέτηση σφαιρών κατά μήκος του x
            for(let x = 50; x < p.width - 50; x += (this.ballSize + this.gap)){
              this.balls.push({ x: x, base: this.basePos, current: this.basePos });
            }
          } else {
            // Κατακόρυφη: τοποθέτηση σφαιρών κατά μήκος του y
            for(let y = 50; y < p.height - 50; y += (this.ballSize + this.gap)){
              this.balls.push({ y: y, base: this.basePos, current: this.basePos });
            }
          }
          this.updateDirection();
        };

        this.updateDirection = function() {
          if(!window.isVertical){
            // Οριζόντια λειτουργία: 'left' σημαίνει χειρός στα αριστερά, 'right' στα δεξιά
            if(this.params.direction === 'left'){
              this.hand.img = handLeft;
              this.hand.pos.x = 50;
            } else {
              this.hand.img = handRight;
              this.hand.pos.x = p.width - 50;
            }
          } else {
            // Κατακόρυφη: ερμηνεύουμε το 'left' ως "πάνω" και 'right' ως "κάτω"
            if(this.params.direction === 'left'){
              this.hand.img = handLeft;
              this.hand.pos.y = 50;
            } else {
              this.hand.img = handRight;
              this.hand.pos.y = p.height - 50;
            }
          }
        };

        this.update = function(t) {
          let phaseRad = p.radians(this.params.phase);
          if(!window.isVertical){
            for(let i = 0; i < this.balls.length; i++){
              let displacement = this.params.amplitude * p.sin(2 * p.PI * this.params.frequency * t + phaseRad);
              this.balls[i].current = this.balls[i].base + displacement;
            }
            if(this.balls.length > 0) { this.hand.pos.y = this.balls[0].current; }
          } else {
            for(let i = 0; i < this.balls.length; i++){
              let displacement = this.params.amplitude * p.sin(2 * p.PI * this.params.frequency * t + phaseRad);
              this.balls[i].current = this.balls[i].base + displacement;
            }
            if(this.balls.length > 0) { this.hand.pos.x = this.balls[0].current; }
          }
        };

        this.draw = function() {
          let r = p.red(this.col), g = p.green(this.col), b = p.blue(this.col);
          p.fill(r, g, b, 100);
          if(!window.isVertical){
            for(let i = 0; i < this.balls.length; i++){
              p.ellipse(this.balls[i].x, this.balls[i].current, this.ballSize);
            }
          } else {
            for(let i = 0; i < this.balls.length; i++){
              p.ellipse(this.balls[i].current, this.balls[i].y, this.ballSize);
            }
          }
          if(this.hand.img) {
            p.image(this.hand.img, this.hand.pos.x, this.hand.pos.y, 32, 32);
          }
        };
      }
    };
    new p5(simulationSketch);

    /* ------------------------------ */
    /* p5 Sketch: Επιλογείς Κυμάτων (Options) */
    /* ------------------------------ */
    let optionsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(320, 400);
        canvas.parent('options-container');
        p.background(230);
        // Χρησιμοποιούμε DOM στοιχεία για τις ρυθμίσεις με overlay γραφικών στοιχείων

        // Ρυθμίσεις για το Μπλε Κύμα
        let blueTitle = p.createElement('h3', 'Μπλε Κύμα');
        blueTitle.parent('options-container');
        blueTitle.style('color', '#0066cc');

        let blueAmpLabel = p.createElement('label', 'Ύψος');
        blueAmpLabel.parent('options-container');
        let blueAmpSlider = p.createSlider(0, 100, window.blueParams.amplitude, 1);
        blueAmpSlider.parent('options-container');
        blueAmpSlider.changed(function() {
          window.blueParams.amplitude = parseInt(this.value());
        });

        let blueFreqLabel = p.createElement('label', 'Συχνότητα');
        blueFreqLabel.parent('options-container');
        let blueFreqSlider = p.createSlider(0.1, 5, window.blueParams.frequency, 0.1);
        blueFreqSlider.parent('options-container');
        blueFreqSlider.changed(function() {
          window.blueParams.frequency = parseFloat(this.value());
        });

        let bluePhaseLabel = p.createElement('label', 'Φάση');
        bluePhaseLabel.parent('options-container');
        let bluePhaseSelect = p.createSelect();
        bluePhaseSelect.parent('options-container');
        bluePhaseSelect.option('0°', '0');
        bluePhaseSelect.option('180°', '180');
        bluePhaseSelect.changed(function() {
          window.blueParams.phase = parseInt(this.value());
        });

        let blueDirLabel = p.createElement('label', 'Κατεύθυνση');
        blueDirLabel.parent('options-container');
        let blueDirSelect = p.createSelect();
        blueDirSelect.parent('options-container');
        blueDirSelect.option('Αριστερά', 'left');
        blueDirSelect.option('Δεξιά', 'right');
        blueDirSelect.changed(function() {
          window.blueParams.direction = this.value();
        });

        // Ρυθμίσεις για το Κόκκινο Κύμα
        let redTitle = p.createElement('h3', 'Κόκκινο Κύμα');
        redTitle.parent('options-container');
        redTitle.style('color', '#cc0000');

        let redAmpLabel = p.createElement('label', 'Ύψος');
        redAmpLabel.parent('options-container');
        let redAmpSlider = p.createSlider(0, 100, window.redParams.amplitude, 1);
        redAmpSlider.parent('options-container');
        redAmpSlider.changed(function() {
          window.redParams.amplitude = parseInt(this.value());
        });

        let redFreqLabel = p.createElement('label', 'Συχνότητα');
        redFreqLabel.parent('options-container');
        let redFreqSlider = p.createSlider(0.1, 5, window.redParams.frequency, 0.1);
        redFreqSlider.parent('options-container');
        redFreqSlider.changed(function() {
          window.redParams.frequency = parseFloat(this.value());
        });

        let redPhaseLabel = p.createElement('label', 'Φάση');
        redPhaseLabel.parent('options-container');
        let redPhaseSelect = p.createSelect();
        redPhaseSelect.parent('options-container');
        redPhaseSelect.option('0°', '0');
        redPhaseSelect.option('180°', '180');
        redPhaseSelect.changed(function() {
          window.redParams.phase = parseInt(this.value());
        });

        let redDirLabel = p.createElement('label', 'Κατεύθυνση');
        redDirLabel.parent('options-container');
        let redDirSelect = p.createSelect();
        redDirSelect.parent('options-container');
        redDirSelect.option('Αριστερά', 'left');
        redDirSelect.option('Δεξιά', 'right');
        redDirSelect.changed(function() {
          window.redParams.direction = this.value();
        });
      };
      p.draw = function() {
        // Δεν απαιτείται συνεχής σχεδίαση
      };
    };
    new p5(optionsSketch);

    /* ------------------------------ */
    /* p5 Sketch: Χειριστήρια (Controls) */
    /* ------------------------------ */
    let controlsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(800, 120);
        canvas.parent('controls-container');
        p.textSize(16);

        // Δημιουργία κουμπιών Play/Pause και Reset ως DOM στοιχεία (με overlay γραφικών στοιχείων)
        let playBtn = p.createButton('▶ Start');
        playBtn.parent('controls-container');
        playBtn.position(20, 20);
        playBtn.mousePressed(function() {
          window.isPlaying = !window.isPlaying;
          playBtn.html(window.isPlaying ? '⏸ Pause' : '▶ Start');
        });
        let resetBtn = p.createButton('↻ Reset');
        resetBtn.parent('controls-container');
        resetBtn.position(120, 20);
        resetBtn.mousePressed(function() {
          window.simTime = 0;
        });
        // Checkbox για επιλογή μεταξύ οριζόντιας και κατακόρυφης λειτουργίας
        let modeCheckbox = p.createCheckbox('Κατακόρυφο κύμα', window.isVertical);
        modeCheckbox.parent('controls-container');
        modeCheckbox.position(220, 20);
        modeCheckbox.changed(function() {
          window.isVertical = this.checked();
          // Επαναφόρτωση της σελίδας για εφαρμογή της νέας λειτουργίας χωρίς αλλαγή λογικής προσομοίωσης
          location.reload();
        });
        // Slider για ταχύτητα προσομοίωσης
        let speedLabel = p.createElement('label', 'Ταχύτητα');
        speedLabel.parent('controls-container');
        speedLabel.position(20, 60);
        let speedSlider = p.createSlider(0.1, 5, window.simSpeed, 0.1);
        speedSlider.parent('controls-container');
        speedSlider.position(100, 60);
        speedSlider.changed(function() {
          window.simSpeed = parseFloat(this.value());
        });
      };
      p.draw = function() {
        p.background(220,220,220,50);
      };
    };
    new p5(controlsSketch);
  </script>
</body>
</html>
