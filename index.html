<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      font-family: Arial, sans-serif;
      background: #f8f9fa;
    }
    #main-container {
      flex: 1;
      display: flex;
      padding: 10px;
      gap: 15px;
    }
    #wave-section {
      flex: 3;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
    }
    #canvas-container {
      flex: 1;
      padding: 20px;
    }
    #controls-panel {
      width: 280px;
      background: white;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    #global-controls-row {
      display: flex;
      gap: 15px;
      padding: 10px;
      background: white;
      border-top: 1px solid #eee;
      align-items: center;
    }
    .wave-controls {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    h3 {
      margin-bottom: 12px;
      font-size: 1em;
    }
    .blue-title { color: #0066cc; }
    .red-title { color: #cc0000; }
    .control-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      font-size: 0.85em;
      color: #666;
      margin-bottom: 3px;
    }
    select {
      width: 100%;
      padding: 6px;
      font-size: 0.85em;
      border: 1px solid #ddd;
      border-radius: 3px;
    }
    .p5-slider {
      width: 100% !important;
      margin: 8px 0 !important;
    }
    button {
      padding: 6px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: background 0.3s;
      font-size: 0.85em;
    }
    button:hover {
      background: #0056b3;
    }
    .compact-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .speed-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: auto;
    }
    #speed-value {
      font-size: 0.9em;
      color: #666;
      min-width: 40px;
    }
  </style>
</head>
<body>
  <div id="main-container">
    <div id="wave-section">
      <div id="canvas-container"></div>
    </div>
    
    <div id="controls-panel">
      <!-- Μπλε Κύμα -->
      <div class="wave-controls">
        <h3 class="blue-title">Μπλε Κύμα</h3>
        <div class="compact-row">
          <div class="control-group">
            <label>Ύψος</label>
            <div id="amplitude-slider-blue"></div>
            <span id="amplitude-value-blue">20</span>
          </div>
          <div class="control-group">
            <label>Συχνότητα</label>
            <div id="frequency-slider-blue"></div>
            <span id="frequency-value-blue">1</span>
          </div>
        </div>
        <div class="compact-row">
          <div class="control-group">
            <label>Φάση</label>
            <select class="phase-select" data-wave="blue">
              <option value="0">0°</option>
              <option value="180">180°</option>
            </select>
          </div>
          <div class="control-group">
            <label>Κατεύθυνση</label>
            <select class="direction-select" data-wave="blue">
              <option value="left">Αριστερά</option>
              <option value="right">Δεξιά</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Κόκκινο Κύμα -->
      <div class="wave-controls">
        <h3 class="red-title">Κόκκινο Κύμα</h3>
        <div class="compact-row">
          <div class="control-group">
            <label>Ύψος</label>
            <div id="amplitude-slider-red"></div>
            <span id="amplitude-value-red">20</span>
          </div>
          <div class="control-group">
            <label>Συχνότητα</label>
            <div id="frequency-slider-red"></div>
            <span id="frequency-value-red">1</span>
          </div>
        </div>
        <div class="compact-row">
          <div class="control-group">
            <label>Φάση</label>
            <select class="phase-select" data-wave="red">
              <option value="0">0°</option>
              <option value="180">180°</option>
            </select>
          </div>
          <div class="control-group">
            <label>Κατεύθυνση</label>
            <select class="direction-select" data-wave="red">
              <option value="left">Αριστερά</option>
              <option value="right">Δεξιά</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Global Controls Bar -->
  <div id="global-controls-row">
    <button id="playBtn">▶</button>
    <button id="resetBtn">↻</button>
    <!-- Επιλογέας οπτικοποίησης κύματος -->
    <select id="wave-type-select" style="width: 150px;">
      <option value="transverse">Εγκάρσιο</option>
      <option value="longitudinal">Διαμήκιο</option>
    </select>
    <select id="green-visibility" style="width: 100px;">
      <option value="visible">Πράσινο</option>
      <option value="hidden">Κρυφό</option>
    </select>
    
    <div class="speed-control">
      <label>Ταχύτητα</label>
      <div id="speed-slider" style="width: 150px;"></div>
      <span id="speed-value">100</span>
    </div>
  </div>

  <script>
    // Φόρτωση εικόνων για τα "χέρια"
    let handLeft, handRight;
    function preload() {
      handLeft = loadImage('handleft.png');
      handRight = loadImage('handright.png');
    }

    class WaveSystem {
      constructor(color, baseLine, waveKey) {
        this.waveKey = waveKey;
        this.balls = [];
        this.color = color;
        // Για εγκάρσιο κύμα, baseLine είναι το y σταθερό, για διαμήκιο είναι το x σταθερό
        this.baseLine = baseLine;
        this.amplitude = 20;
        this.frequency = 1;
        this.phase = 0;
        this.direction = 'left';
        // Μέγεθος για απεικόνιση (δείκτης για "μπάλα" – θα χρησιμοποιηθεί ως βάση για το x ή y)
        this.ballSize = 2;
        this.gap = 1;
        
        this.selectDirection = select(`[data-wave="${this.waveKey}"].direction-select`);
        this.selectPhase = select(`[data-wave="${this.waveKey}"].phase-select`);
        
        this.hand = {
          img: handLeft,
          // Αρχικές θέσεις: για εγκάρσιο το x καθορίζεται, για διαμήκιο το y παραμένει σταθερό
          x: this.direction === 'left' ? 50 : width - 50,
          y: this.baseLine,
          firstBall: null
        };

        this.selectDirection.changed(() => this.updateDirection());
        this.selectPhase.changed(() => this.phase = parseInt(this.selectPhase.value()));
      }

      updateHandPosition() {
        this.hand.img = this.direction === 'left' ? handLeft : handRight;
        // Ανάλογα με τον τύπο κύματος, θέτουμε το σταθερό σημείο εκκίνησης
        this.hand.x = this.direction === 'left' ? 50 : width - 50;
        this.updateFirstBall();
      }

      updateFirstBall() {
        const startPos = this.direction === 'left' ? 50 : width - 50;
        // Εύρεση του πρώτου στοιχείου με βάση τη διαφορά από την αρχική θέση.
        this.hand.firstBall = this.balls.reduce((closest, ball) => {
          const distance = Math.abs(ball.x - startPos);
          return distance < closest.distance ? {ball, distance} : closest;
        }, {ball: null, distance: Infinity}).ball;
      }

      initBalls() {
        // Δημιουργούμε τα σημεία κατά μήκος του x (για εγκάρσιο) ή του y (για διαμήκιο) – εδώ χρησιμοποιούμε το x ως βάση
        const totalSpace = this.ballSize + this.gap;
        for (let x = 50; x < width - 50; x += totalSpace) {
          this.balls.push({ 
            x: x,
            baseY: this.baseLine,
            startTime: Infinity,
            currentY: this.baseLine // για εγκάρσιο κύμα
            // για διαμήκιο, το ball.x θα χρησιμοποιηθεί ως βάση
          });
        }
        this.updateFirstBall();
      }

      updateDirection() {
        this.direction = this.selectDirection.value();
        this.updateStartTimes(speed);
        this.updateHandPosition();
      }

      updateStartTimes(speed) {
        const startPos = this.direction === 'left' ? 50 : width - 50;
        this.balls.forEach(ball => {
          const distance = Math.abs(ball.x - startPos);
          ball.startTime = speed > 0 ? distance / speed : Infinity;
        });
      }

      draw(simTime, speed) {
        fill(this.color);
        // Ανάγνωση του τύπου κύματος από τον global επιλογέα
        const waveType = select('#wave-type-select').value();
        
        // Ενημέρωση θέσης του "χεριού" ανάλογα με τον τύπο
        if(waveType === 'transverse'){
          if(this.hand.firstBall) this.hand.y = this.hand.firstBall.currentY;
        } else if(waveType === 'longitudinal'){
          if(this.hand.firstBall) {
            const t = simTime - this.hand.firstBall.startTime;
            const phase = radians(this.phase) + TWO_PI * this.frequency * t;
            this.hand.x = this.hand.firstBall.x + this.amplitude * sin(phase);
          }
        }

        this.balls.forEach(ball => {
          if(simTime >= ball.startTime) {
            const t = simTime - ball.startTime;
            const phase = radians(this.phase) + TWO_PI * this.frequency * t;
            if(waveType === 'transverse'){
              ball.currentY = ball.baseY + this.amplitude * sin(phase);
            } else if(waveType === 'longitudinal'){
              // Για διαμήκιο, μετατοπίζουμε το x, ενώ το y παραμένει σταθερό (ball.baseY)
              ball.currentX = ball.x + this.amplitude * sin(phase);
            }
          } else {
            if(waveType === 'transverse'){
              ball.currentY = ball.baseY;
            } else {
              ball.currentX = ball.x;
            }
          }
          rectMode(CENTER);
          if(waveType === 'transverse'){
            // Κατακόρυφη μπάρα: πλάτος 2px, ύψος 60px
            rect(ball.x, ball.currentY, 2, 60);
          } else if(waveType === 'longitudinal'){
            // Οριζόντια μπάρα: πλάτος 60px, ύψος 2px
            rect(ball.currentX, ball.baseY, 60, 2);
          }
        });
      }
    }

    let blueWave, redWave;
    let isPlaying = false;
    let simTime = 0;
    let lastUpdate = 0;
    let speed = 100;
    const greenBaseY = 200;
    let greenVisible = true;

    function setup() {
      const canvas = createCanvas(800, 400);
      canvas.parent('canvas-container');
      noStroke();
      imageMode(CENTER);

      blueWave = new WaveSystem(color(0, 100, 200), 100, 'blue');
      redWave = new WaveSystem(color(200, 0, 0), 300, 'red');
      blueWave.initBalls();
      redWave.initBalls();
      blueWave.updateHandPosition();
      redWave.updateHandPosition();

      // Speed Slider
      const speedSlider = createSlider(0, 500, 100);
      speedSlider.parent('speed-slider');
      speedSlider.input(() => {
        speed = speedSlider.value();
        select('#speed-value').html(speed);
        blueWave.updateStartTimes(speed);
        redWave.updateStartTimes(speed);
      });

      // Blue Sliders
      createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-blue', 'amplitude-value-blue', v => blueWave.amplitude = v);
      createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-blue', 'frequency-value-blue', v => blueWave.frequency = v);

      // Red Sliders
      createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-red', 'amplitude-value-red', v => redWave.amplitude = v);
      createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-red', 'frequency-value-red', v => redWave.frequency = v);

      // Controls
      select('#playBtn').mousePressed(() => {
        isPlaying = !isPlaying;
        select('#playBtn').html(isPlaying ? '⏸' : '▶');
        lastUpdate = millis();
      });
      
      select('#resetBtn').mousePressed(() => {
        simTime = 0;
        isPlaying = false;
        blueWave.initBalls();
        redWave.initBalls();
        redraw();
      });

      select('#green-visibility').changed(() => {
        greenVisible = select('#green-visibility').value() === 'visible';
      });
    }

    function createSliderWithUpdates(min, max, value, step, parentId, valueId, updateCallback) {
      const parent = document.getElementById(parentId);
      if(parent) {
        const slider = createSlider(min, max, value, step);
        slider.parent(parent);
        slider.input(() => {
          const val = step >= 1 ? slider.value() : slider.value().toFixed(1);
          select('#'+valueId).html(val);
          updateCallback(parseFloat(val));
        });
      }
    }

    function draw() {
      background(245);
      // Γραμμές αναφοράς (η "ευθεία διάδοσης")
      stroke(200);
      drawingContext.setLineDash([5, 5]);
      // Για εγκάρσιο κύμα, η ευθεία είναι οριζόντια στο baseLine,
      // ενώ για διαμήκιο, μπορούμε να αφήσουμε την ευθεία ως οριζόντια για σύγκριση.
      line(50, blueWave.baseLine, width-50, blueWave.baseLine);
      line(50, redWave.baseLine, width-50, redWave.baseLine);
      line(50, greenBaseY, width-50, greenBaseY);
      drawingContext.setLineDash([]);

      if(isPlaying) {
        const now = millis();
        simTime += (now - lastUpdate) / 1000;
        lastUpdate = now;
      }

      blueWave.draw(simTime, speed);
      redWave.draw(simTime, speed);

      // Πράσινο κύμα ως συνδυασμός (δείχνει πώς το μέσο μπορεί να επηρεάζεται)
      if(greenVisible) {
        fill(0, 200, 0);
        for(let i = 0; i < blueWave.balls.length; i++) {
          // Ο συνδυασμός των μετατοπίσεων των δύο κυμάτων
          const y = greenBaseY + 
                   (blueWave.balls[i].currentY - blueWave.baseLine) + 
                   (redWave.balls[i].currentY - redWave.baseLine);
          ellipse(blueWave.balls[i].x, y, 2, 2);
        }
      }

      // Σχεδίαση των "χειρών"
      if(isPlaying) {
        // Ανάλογα με τον τύπο κύματος, σχεδιάζουμε το χέρι στη μετατοπισμένη θέση
        const waveType = select('#wave-type-select').value();
        if(waveType === 'transverse'){
          image(blueWave.hand.img, blueWave.hand.x, blueWave.hand.y, 32, 32);
          image(redWave.hand.img, redWave.hand.x, redWave.hand.y, 32, 32);
        } else if(waveType === 'longitudinal'){
          image(blueWave.hand.img, blueWave.hand.x, blueWave.baseLine, 32, 32);
          image(redWave.hand.img, redWave.hand.x, redWave.baseLine, 32, 32);
        }
      }
    }
  </script>
</body>
</html>
