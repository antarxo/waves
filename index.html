<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wave Simulator with Overlays - Δοκιμή</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    #top-container {
      display: flex;
      width: 1100px;
      margin-top: 10px;
    }
    #simulation-container {
      border: 1px solid #ccc;
      position: relative;
    }
    #options-container {
      border: 1px solid #ccc;
      margin-left: 10px;
    }
    #controls-container {
      margin-top: 10px;
      border: 1px solid #ccc;
      width: 800px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="top-container">
      <!-- Καμβάς προσομοίωσης -->
      <div id="simulation-container"></div>
      <!-- Καμβάς επιλογών -->
      <div id="options-container"></div>
    </div>
    <!-- Καμβάς χειριστηρίων -->
    <div id="controls-container"></div>
  </div>
  
  <script>
    // Global μεταβλητές
    window.simTime = 0;
    window.lastSimMillis = 0;
    window.isPlaying = false;
    window.simSpeed = 1;
    window.greenBaseY = 200;
    // Παράμετροι κυμάτων
    window.blueParams = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    window.redParams  = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };

    /* -------------------------- */
    /* p5 Sketch: Προσομοίωση     */
    /* -------------------------- */
    let simulationSketch = function(p) {
      let blueWave, redWave;
      p.setup = function() {
        let canvas = p.createCanvas(800, 400);
        canvas.parent('simulation-container');
        blueWave = new WaveSystem(p, p.color(0, 100, 200), 100, window.blueParams);
        redWave  = new WaveSystem(p, p.color(200, 0, 0), 300, window.redParams);
        blueWave.initBalls();
        redWave.initBalls();
        window.lastSimMillis = p.millis();
      };

      p.draw = function() {
        p.background(245);
        // Γραμμές αναφοράς
        p.stroke(200);
        p.line(50, 100, p.width - 50, 100);
        p.line(50, 300, p.width - 50, 300);
        p.line(50, window.greenBaseY, p.width - 50, window.greenBaseY);
        p.noStroke();

        // Ενημέρωση χρόνου προσομοίωσης
        if (window.isPlaying) {
          let now = p.millis();
          let dt = (now - window.lastSimMillis) / 1000 * window.simSpeed;
          window.simTime += dt;
          window.lastSimMillis = now;
        } else {
          window.lastSimMillis = p.millis();
        }

        blueWave.update(window.simTime);
        redWave.update(window.simTime);
        blueWave.draw();
        redWave.draw();

        // Σχεδίαση πράσινου κύματος ως συνδυασμός μετατοπίσεων
        p.fill(0, 200, 0, 100);
        for (let i = 0; i < blueWave.balls.length; i++) {
          let blueDisp = blueWave.balls[i].currentY - blueWave.baseY;
          let redDisp = redWave.balls[i].currentY - redWave.baseY;
          let greenY = window.greenBaseY + blueDisp + redDisp;
          p.ellipse(blueWave.balls[i].x, greenY, 8);
        }
      };

      // Κλάση WaveSystem
      function WaveSystem(p, col, baseY, params) {
        this.p = p;
        this.col = col;
        this.baseY = baseY;
        this.params = params;
        this.balls = [];
        this.ballDiameter = 8;
        this.gap = 10;

        this.initBalls = function() {
          this.balls = [];
          for (let x = 50; x < p.width - 50; x += (this.ballDiameter + this.gap)) {
            this.balls.push({ x: x, currentY: this.baseY });
          }
        };

        this.update = function(t) {
          for (let i = 0; i < this.balls.length; i++) {
            let phaseRad = p.radians(this.params.phase);
            let displacement = this.params.amplitude * p.sin(2 * p.PI * this.params.frequency * t + phaseRad);
            this.balls[i].currentY = this.baseY + displacement;
          }
        };

        this.draw = function() {
          let r = p.red(this.col), g = p.green(this.col), b = p.blue(this.col);
          p.fill(r, g, b, 100);
          for (let i = 0; i < this.balls.length; i++) {
            p.ellipse(this.balls[i].x, this.balls[i].currentY, this.ballDiameter);
          }
        };
      }
    };
    new p5(simulationSketch);

    /* -------------------------- */
    /* p5 Sketch: Επιλογές Κυμάτων  */
    /* -------------------------- */
    let optionsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(300, 400);
        canvas.parent('options-container');
      };

      p.draw = function() {
        p.background(230);
        p.fill(50);
        p.textSize(16);
        p.text('Επιλογές Κυμάτων', 10, 30);

        // Επιλογές για το Μπλε Κύμα
        p.fill(0, 100, 200);
        p.text('Μπλε Κύμα:', 10, 60);
        p.fill(0);
        p.text('Ύψος: ' + window.blueParams.amplitude, 10, 80);
        p.text('Συχνότητα: ' + window.blueParams.frequency, 10, 100);
        p.text('Φάση: ' + window.blueParams.phase + '°', 10, 120);
        p.text('Κατεύθυνση: ' + window.blueParams.direction, 10, 140);

        // Επιλογές για το Κόκκινο Κύμα
        p.fill(200, 0, 0);
        p.text('Κόκκινο Κύμα:', 10, 180);
        p.fill(0);
        p.text('Ύψος: ' + window.redParams.amplitude, 10, 200);
        p.text('Συχνότητα: ' + window.redParams.frequency, 10, 220);
        p.text('Φάση: ' + window.redParams.phase + '°', 10, 240);
        p.text('Κατεύθυνση: ' + window.redParams.direction, 10, 260);
      };
    };
    new p5(optionsSketch);

    /* -------------------------- */
    /* p5 Sketch: Χειριστήρια      */
    /* -------------------------- */
    let controlsSketch = function(p) {
      let playButton, resetButton, sliderX, sliderY, sliderW, sliderH;
      let dragging = false;
      
      p.setup = function() {
        let canvas = p.createCanvas(800, 100);
        canvas.parent('controls-container');
        playButton = { x: 10, y: 10, w: 80, h: 30 };
        resetButton = { x: 100, y: 10, w: 80, h: 30 };
        sliderX = 10; sliderY = 60; sliderW = 200; sliderH = 10;
      };

      p.draw = function() {
        p.background(210);
        // Κουμπί Play/Pause
        if (window.isPlaying) {
          p.fill(100, 255, 100);
          p.rect(playButton.x, playButton.y, playButton.w, playButton.h, 5);
          p.fill(0);
          p.text('Pause', playButton.x + 10, playButton.y + 20);
        } else {
          p.fill(100, 200, 255);
          p.rect(playButton.x, playButton.y, playButton.w, playButton.h, 5);
          p.fill(0);
          p.text('Play', playButton.x + 15, playButton.y + 20);
        }
        // Κουμπί Reset
        p.fill(255, 150, 150);
        p.rect(resetButton.x, resetButton.y, resetButton.w, resetButton.h, 5);
        p.fill(0);
        p.text('Reset', resetButton.x + 10, resetButton.y + 20);

        // Slider Ταχύτητας
        p.fill(200);
        p.rect(sliderX, sliderY, sliderW, sliderH, 5);
        let norm = (window.simSpeed - 0.1) / (5 - 0.1);
        let knobX = sliderX + norm * sliderW;
        p.fill(150);
        p.ellipse(knobX, sliderY + sliderH / 2, 15);
        p.fill(0);
        p.text('Ταχύτητα: ' + window.simSpeed.toFixed(1), sliderX + sliderW + 20, sliderY + sliderH);
      };

      p.mousePressed = function() {
        // Έλεγχος για το κουμπί Play/Pause
        if (p.mouseX >= playButton.x && p.mouseX <= playButton.x + playButton.w &&
            p.mouseY >= playButton.y && p.mouseY <= playButton.y + playButton.h) {
          window.isPlaying = !window.isPlaying;
        }
        // Έλεγχος για το κουμπί Reset
        if (p.mouseX >= resetButton.x && p.mouseX <= resetButton.x + resetButton.w &&
            p.mouseY >= resetButton.y && p.mouseY <= resetButton.y + resetButton.h) {
          window.simTime = 0;
        }
        // Έλεγχος για το slider
        if (p.mouseX >= sliderX && p.mouseX <= sliderX + sliderW &&
            p.mouseY >= sliderY && p.mouseY <= sliderY + sliderH) {
          dragging = true;
          updateSlider(p.mouseX);
        }
      };

      p.mouseDragged = function() {
        if (dragging) { updateSlider(p.mouseX); }
      };

      p.mouseReleased = function() {
        dragging = false;
      };

      function updateSlider(mx) {
        let clamped = p.constrain(mx, sliderX, sliderX + sliderW);
        let norm = (clamped - sliderX) / sliderW;
        window.simSpeed = 0.1 + norm * (5 - 0.1);
      }
    };
    new p5(controlsSketch);
  </script>
</body>
</html>
