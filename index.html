<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wave Simulator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      display: flex; 
      flex-direction: column;
      min-height: 100vh; 
      font-family: Arial, sans-serif; 
      background: #f0f0f0; 
    }
    #main-container { 
      flex: 1;
      display: flex; 
      padding: 10px; 
      gap: 15px; 
    }
    #wave-section { 
      flex: 3; 
      background: white; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    }
    #controls-panel { 
      width: 280px; 
      background: white; 
      padding: 15px; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    }
    .wave-controls { margin-bottom: 20px; }
    h3 { color: #444; margin-bottom: 15px; }
    .blue-title { color: #0066cc; }
    .red-title { color: #cc0000; }
    .control-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; color: #666; }
    select, button { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    #global-controls { display: flex; gap: 10px; margin-top: 20px; }
  </style>
</head>
<body>
  <div id="main-container">
    <div id="wave-section">
      <div id="canvas-container"></div>
    </div>
    
    <div id="controls-panel">
      <!-- Μπλε Κύμα -->
      <div class="wave-controls">
        <h3 class="blue-title">Μπλε Κύμα</h3>
        <div class="control-group">
          <label>Ύψος</label>
          <div id="amplitude-slider-blue"></div>
          <span id="amplitude-value-blue">20</span>
        </div>
        <div class="control-group">
          <label>Συχνότητα</label>
          <div id="frequency-slider-blue"></div>
          <span id="frequency-value-blue">1</span>
        </div>
        <div class="control-group">
          <label>Φάση</label>
          <select class="phase-select" data-wave="blue">
            <option value="0">0°</option>
            <option value="180">180°</option>
          </select>
        </div>
        <div class="control-group">
          <label>Κατεύθυνση</label>
          <select class="direction-select" data-wave="blue">
            <option value="left">Αριστερά</option>
            <option value="right">Δεξιά</option>
          </select>
        </div>
      </div>

      <!-- Κόκκινο Κύμα -->
      <div class="wave-controls">
        <h3 class="red-title">Κόκκινο Κύμα</h3>
        <div class="control-group">
          <label>Ύψος</label>
          <div id="amplitude-slider-red"></div>
          <span id="amplitude-value-red">20</span>
        </div>
        <div class="control-group">
          <label>Συχνότητα</label>
          <div id="frequency-slider-red"></div>
          <span id="frequency-value-red">1</span>
        </div>
        <div class="control-group">
          <label>Φάση</label>
          <select class="phase-select" data-wave="red">
            <option value="0">0°</option>
            <option value="180">180°</option>
          </select>
        </div>
        <div class="control-group">
          <label>Κατεύθυνση</label>
          <select class="direction-select" data-wave="red">
            <option value="left">Αριστερά</option>
            <option value="right">Δεξιά</option>
          </select>
        </div>
      </div>

      <div id="global-controls">
        <button id="playBtn">▶ Start</button>
        <button id="resetBtn">↻ Reset</button>
        <select id="green-visibility">
          <option value="visible">Πράσινο</option>
          <option value="hidden">Κρυφό</option>
        </select>
      </div>
    </div>
  </div>

  <script>
    let blueWave, redWave;
    let isPlaying = false;
    let simTime = 0;
    let lastUpdate = 0;
    let speed = 100;
    const greenBaseY = 200;
    let greenVisible = true;

    function preload() {
      // Fallback αν δεν βρεθούν οι εικόνες
      this._preloadHands = () => {
        handLeft = createGraphics(32,32);
        handLeft.fill(0,100,200);
        handLeft.ellipse(16,16,32,32);
        
        handRight = createGraphics(32,32);
        handRight.fill(200,0,0);
        handRight.ellipse(16,16,32,32);
      }
      try {
        handLeft = loadImage('handleft.png');
        handRight = loadImage('handright.png');
      } catch(e) { this._preloadHands(); }
    }

    class WaveSystem {
      constructor(color, yPos, waveKey) {
        this.color = color;
        this.yPos = yPos;
        this.waveKey = waveKey;
        this.balls = [];
        this.amplitude = 20;
        this.frequency = 1;
        this.phase = 0;
        this.direction = 'left';
        this.ballSize = 4;
        this.gap = 2;
        
        this.selectDirection = select(`[data-wave="${waveKey}"].direction-select`);
        this.selectPhase = select(`[data-wave="${waveKey}"].phase-select`);
        
        this.hand = {
          img: waveKey === 'blue' ? handLeft : handRight,
          x: 50,
          y: yPos
        };

        this.selectDirection.changed(() => this.updateDirection());
        this.selectPhase.changed(() => this.phase = parseInt(this.selectPhase.value()));
      }

      initBalls() {
        const totalSpace = this.ballSize + this.gap;
        for(let x = 50; x < width - 50; x += totalSpace) {
          this.balls.push({ 
            x: x,
            baseY: this.yPos,
            startTime: Infinity,
            currentY: this.yPos 
          });
        }
      }

      updateDirection() {
        this.direction = this.selectDirection.value();
        this.hand.img = this.direction === 'left' ? handLeft : handRight;
        this.hand.x = this.direction === 'left' ? 50 : width - 50;
      }

      update(simTime) {
        this.balls.forEach(ball => {
          if(simTime >= ball.startTime) {
            const t = simTime - ball.startTime;
            const phase = radians(this.phase) + TWO_PI * this.frequency * t;
            ball.currentY = ball.baseY + this.amplitude * sin(phase);
          } else {
            ball.currentY = ball.baseY;
          }
        });
        if(this.balls.length > 0) this.hand.y = this.balls[0].currentY;
      }

      draw() {
        fill(this.color);
        this.balls.forEach(ball => ellipse(ball.x, ball.currentY, this.ballSize));
        image(this.hand.img, this.hand.x, this.hand.y, 32, 32);
      }
    }

    function setup() {
      const canvas = createCanvas(800, 400);
      canvas.parent('canvas-container');
      noStroke();
      imageMode(CENTER);

      blueWave = new WaveSystem(color(0, 100, 200), 100, 'blue');
      redWave = new WaveSystem(color(200, 0, 0), 300, 'red');
      blueWave.initBalls();
      redWave.initBalls();

      // Sliders
      createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-blue', 'amplitude-value-blue', v => blueWave.amplitude = v);
      createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-blue', 'frequency-value-blue', v => blueWave.frequency = v);
      createSliderWithUpdates(0, 100, 20, 1, 'amplitude-slider-red', 'amplitude-value-red', v => redWave.amplitude = v);
      createSliderWithUpdates(0.1, 5, 1, 0.1, 'frequency-slider-red', 'frequency-value-red', v => redWave.frequency = v);

      // Controls
      select('#playBtn').mousePressed(() => {
        isPlaying = !isPlaying;
        select('#playBtn').html(isPlaying ? '⏸ Pause' : '▶ Start');
        lastUpdate = millis();
      });
      
      select('#resetBtn').mousePressed(() => {
        simTime = 0;
        isPlaying = false;
        blueWave.initBalls();
        redWave.initBalls();
      });

      select('#green-visibility').changed(() => {
        greenVisible = select('#green-visibility').value() === 'visible';
      });
    }

    function createSliderWithUpdates(min, max, value, step, parentId, valueId, updateCallback) {
      const parent = document.getElementById(parentId);
      if(parent) {
        const slider = createSlider(min, max, value, step);
        slider.parent(parent);
        slider.input(() => {
          const val = step >= 1 ? slider.value() : slider.value().toFixed(1);
          select('#'+valueId).html(val);
          updateCallback(parseFloat(val));
        });
      }
    }

    function draw() {
      background(245);
      
      // Γραμμές ηρεμίας
      stroke(200);
      line(50, blueWave.yPos, width-50, blueWave.yPos);
      line(50, redWave.yPos, width-50, redWave.yPos);
      line(50, greenBaseY, width-50, greenBaseY);

      if(isPlaying) {
        const now = millis();
        simTime += (now - lastUpdate)/1000;
        lastUpdate = now;
      }

      blueWave.update(simTime);
      redWave.update(simTime);

      // Σχεδίαση κυμάτων
      blueWave.draw();
      redWave.draw();

      // Πράσινο κύμα
      if(greenVisible) {
        fill(0, 200, 0, 100);
        for(let i=0; i<blueWave.balls.length; i++) {
          const y = greenBaseY + 
                   (blueWave.balls[i].currentY - blueWave.yPos) + 
                   (redWave.balls[i].currentY - redWave.yPos);
          ellipse(blueWave.balls[i].x, y, 8);
        }
      }
    }
  </script>
</body>
</html>
