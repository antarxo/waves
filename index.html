<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wave Simulator Final</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    /* Βασικό styling για τη διάταξη */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    #top-container {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    #simulation-container {
      width: 800px;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #options-container {
      width: 320px;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px;
      overflow-y: auto;
    }
    #controls-container {
      width: 800px;
      height: 120px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      margin-bottom: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div id="top-container">
    <div id="simulation-container"></div>
    <div id="options-container"></div>
  </div>
  <div id="controls-container"></div>

  <script>
    /* --- Global Μεταβλητές --- */
    // Παράμετροι κυμάτων
    window.blueParams = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    window.redParams  = { amplitude: 20, frequency: 1, phase: 0, direction: 'left' };
    // Λειτουργία προσομοίωσης
    window.isPlaying = false;
    window.simTime = 0;
    window.lastUpdate = 0;
    window.simSpeed = 1;
    // Ορατότητα πράσινου κυμάτος (υπέρθεση)
    window.greenVisible = true;

    /* ------------------------------ */
    /* p5 Sketch: Simulation Canvas   */
    /* ------------------------------ */
    let simulationSketch = function(p) {
      let blueWave, redWave;
      let handLeft, handRight;
      
      p.preload = function() {
        // Φόρτωση εικόνων χειρών – αν δεν βρεθούν, δημιουργούνται fallback γραφικά
        handLeft = p.loadImage('handleft.png', undefined, function() {
          let g = p.createGraphics(32,32);
          g.fill(0,100,200);
          g.ellipse(16,16,32,32);
          handLeft = g;
        });
        handRight = p.loadImage('handright.png', undefined, function() {
          let g = p.createGraphics(32,32);
          g.fill(200,0,0);
          g.ellipse(16,16,32,32);
          handRight = g;
        });
      };

      p.setup = function() {
        let canvas = p.createCanvas(800, 400);
        canvas.parent('simulation-container');
        p.noStroke();
        p.imageMode(p.CENTER);
        // Δημιουργία των κυμάτων σύμφωνα με την αρχική λογική
        blueWave = new WaveSystem(p, p.color(0,100,200), 100, 'blue');
        redWave  = new WaveSystem(p, p.color(200,0,0), 300, 'red');
        blueWave.initBalls();
        redWave.initBalls();
        window.lastUpdate = p.millis();
      };

      p.draw = function() {
        p.background(245);
        p.stroke(200);
        // Σχεδίαση βασικών γραμμών αναφοράς
        p.line(50, 100, p.width-50, 100);
        p.line(50, 300, p.width-50, 300);
        p.line(50, 200, p.width-50, 200);
        p.noStroke();
        
        let now = p.millis();
        if(window.isPlaying) {
          let dt = (now - window.lastUpdate) / 1000 * window.simSpeed;
          window.simTime += dt;
        }
        window.lastUpdate = now;
        
        blueWave.update(window.simTime);
        redWave.update(window.simTime);
        blueWave.draw();
        redWave.draw();
        
        // Σχεδίαση πράσινου κυμάτος ως υπέρθεση των δύο κυμάτων
        if(window.greenVisible) {
          p.fill(0,200,0,100);
          for(let i = 0; i < blueWave.balls.length; i++){
            let blueOffset = blueWave.balls[i].currentY - blueWave.balls[i].baseY;
            let redOffset = redWave.balls[i].currentY - redWave.balls[i].baseY;
            let greenY = 200 + blueOffset + redOffset;
            p.ellipse(blueWave.balls[i].x, greenY, 8);
          }
        }
      };

      // Κλάση WaveSystem (διατηρείται η αρχική λογική προσομοίωσης)
      function WaveSystem(p, col, baseY, waveKey) {
        this.p = p;
        this.col = col;
        this.baseY = baseY;
        this.waveKey = waveKey;
        this.balls = [];
        this.ballSize = 4;
        this.gap = 2;
        // Η εικόνα του "χεριού" (πηγή του κύματος)
        this.hand = { img: null, x: 50, y: baseY };
        this.updateHand = function() {
          let params = (waveKey === 'blue') ? window.blueParams : window.redParams;
          if(params.direction === 'left') {
            this.hand.img = handLeft;
            this.hand.x = 50;
          } else {
            this.hand.img = handRight;
            this.hand.x = p.width - 50;
          }
        };
        this.initBalls = function() {
          this.balls = [];
          for(let x = 50; x < p.width - 50; x += (this.ballSize + this.gap)){
            this.balls.push({ x: x, baseY: this.baseY, currentY: this.baseY });
          }
          this.updateHand();
        };
        this.update = function(t) {
          let params = (waveKey === 'blue') ? window.blueParams : window.redParams;
          let amplitude = params.amplitude;
          let frequency = params.frequency;
          let phase = p.radians(params.phase);
          for(let i = 0; i < this.balls.length; i++){
            let offset = amplitude * p.sin(2 * p.PI * frequency * t + phase);
            this.balls[i].currentY = this.balls[i].baseY + offset;
          }
          if(this.balls.length > 0) { this.hand.y = this.balls[0].currentY; }
        };
        this.draw = function() {
          let r = p.red(this.col), g = p.green(this.col), b = p.blue(this.col);
          p.fill(r, g, b, 100);
          for(let i = 0; i < this.balls.length; i++){
            p.ellipse(this.balls[i].x, this.balls[i].currentY, this.ballSize);
          }
          if(this.hand.img) {
            p.image(this.hand.img, this.hand.x, this.hand.y, 32, 32);
          }
        };
      }
    };
    new p5(simulationSketch, 'simulation-container');

    /* ------------------------------ */
    /* p5 Sketch: Options Canvas        */
    /* ------------------------------ */
    let optionsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(320, 400);
        canvas.parent('options-container');
        p.textSize(16);
      };
      p.draw = function() {
        p.background(230);
        p.fill(0);
        // Εμφάνιση παραμέτρων για το Μπλε κύμα
        p.fill(0,100,200);
        p.text("Μπλε Κύμα", 10, 30);
        p.fill(0);
        p.text("Ύψος: " + window.blueParams.amplitude, 10, 60);
        p.text("Συχνότητα: " + window.blueParams.frequency, 10, 80);
        p.text("Φάση: " + window.blueParams.phase + "°", 10, 100);
        p.text("Κατεύθυνση: " + window.blueParams.direction, 10, 120);
        // Εμφάνιση παραμέτρων για το Κόκκινο κύμα
        p.fill(200,0,0);
        p.text("Κόκκινο Κύμα", 10, 160);
        p.fill(0);
        p.text("Ύψος: " + window.redParams.amplitude, 10, 190);
        p.text("Συχνότητα: " + window.redParams.frequency, 10, 210);
        p.text("Φάση: " + window.redParams.phase + "°", 10, 230);
        p.text("Κατεύθυνση: " + window.redParams.direction, 10, 250);
      };
    };
    new p5(optionsSketch, 'options-container');

    /* ------------------------------ */
    /* p5 Sketch: Controls Canvas       */
    /* ------------------------------ */
    let controlsSketch = function(p) {
      p.setup = function() {
        let canvas = p.createCanvas(800, 120);
        canvas.parent('controls-container');
        p.textSize(16);
        // Δημιουργία κουμπιών και DOM ελέγχων με overlay γραφικών στοιχείων
        let playBtn = p.createButton('▶ Start');
        playBtn.parent('controls-container');
        playBtn.position(20, 20);
        playBtn.mousePressed(function() {
          window.isPlaying = !window.isPlaying;
          playBtn.html(window.isPlaying ? '⏸ Pause' : '▶ Start');
        });
        let resetBtn = p.createButton('↻ Reset');
        resetBtn.parent('controls-container');
        resetBtn.position(120, 20);
        resetBtn.mousePressed(function() {
          window.simTime = 0;
        });
        let greenCheckbox = p.createCheckbox('Εμφάνιση Πράσινου', window.greenVisible);
        greenCheckbox.parent('controls-container');
        greenCheckbox.position(220, 20);
        greenCheckbox.changed(function() {
          window.greenVisible = this.checked();
        });
        p.createElement('label', 'Ταχύτητα').parent('controls-container').position(20, 60);
        let speedSlider = p.createSlider(0.1, 5, window.simSpeed, 0.1);
        speedSlider.parent('controls-container');
        speedSlider.position(100, 60);
        speedSlider.changed(function() {
          window.simSpeed = parseFloat(this.value());
        });
      };
      p.draw = function() {
        p.background(220,220,220,50);
      };
    };
    new p5(controlsSketch, 'controls-container');
  </script>
</body>
</html>
